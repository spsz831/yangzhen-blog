const { PrismaClient } = require('@prisma/client');
const bcrypt = require('bcryptjs');

const prisma = new PrismaClient();

async function main() {
  console.log('å¼€å§‹æ•°æ®è¿ç§»...');

  // åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
  const adminPassword = await bcrypt.hash('admin123456', 12);

  const admin = await prisma.user.upsert({
    where: { username: 'yangzhen' },
    update: {},
    create: {
      username: 'yangzhen',
      email: 'yangzhen@example.com',
      password: adminPassword,
      role: 'ADMIN'
    }
  });

  console.log('ç®¡ç†å‘˜ç”¨æˆ·å·²åˆ›å»º:', admin.username);

  // åˆ›å»ºé»˜è®¤åˆ†ç±»
  const categories = [
    { name: 'æŠ€æœ¯åˆ†äº«', slug: 'tech', description: 'æŠ€æœ¯ç›¸å…³æ–‡ç« ' },
    { name: 'ç”Ÿæ´»éšç¬”', slug: 'life', description: 'ç”Ÿæ´»æ„Ÿæ‚Ÿå’Œéšç¬”' },
    { name: 'é¡¹ç›®å±•ç¤º', slug: 'projects', description: 'ä¸ªäººé¡¹ç›®å±•ç¤º' }
  ];

  for (const category of categories) {
    await prisma.category.upsert({
      where: { slug: category.slug },
      update: {},
      create: category
    });
  }

  console.log('é»˜è®¤åˆ†ç±»å·²åˆ›å»º');

  // åˆ›å»ºé»˜è®¤æ ‡ç­¾
  const tags = [
    { name: 'JavaScript', slug: 'javascript' },
    { name: 'React', slug: 'react' },
    { name: 'Node.js', slug: 'nodejs' },
    { name: 'Claude Code', slug: 'claude-code' },
    { name: 'åšå®¢', slug: 'blog' }
  ];

  for (const tag of tags) {
    await prisma.tag.upsert({
      where: { slug: tag.slug },
      update: {},
      create: tag
    });
  }

  console.log('é»˜è®¤æ ‡ç­¾å·²åˆ›å»º');

  // è¿ç§»çŽ°æœ‰æ–‡ç« 
  const posts = [
    {
      title: 'æ¬¢è¿Žæ¥åˆ° YangZhen ä¸ªäººåšå®¢',
      slug: 'welcome-to-yangzhen-blog',
      content: `# æ¬¢è¿Žæ¥åˆ°æˆ‘çš„ä¸ªäººåšå®¢

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨çŽ°ä»£æŠ€æœ¯æ ˆæž„å»ºçš„ä¸ªäººåšå®¢ç½‘ç«™ã€‚

## æŠ€æœ¯æ ˆ

- **å‰ç«¯**: Next.js + TypeScript + Tailwind CSS
- **åŽç«¯**: Node.js + Express
- **æ•°æ®åº“**: PostgreSQL + Prisma ORM
- **éƒ¨ç½²**: Railway + Vercel

## åŠŸèƒ½ç‰¹æ€§

- ðŸ“ æ–‡ç« å‘å¸ƒä¸Žç®¡ç†
- ðŸ” å…¨æ–‡æœç´¢åŠŸèƒ½
- ðŸ·ï¸ åˆ†ç±»å’Œæ ‡ç­¾ç³»ç»Ÿ
- ðŸ’¬ è¯„è®ºäº’åŠ¨åŠŸèƒ½
- ðŸ‘¤ ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- ðŸ“± å“åº”å¼è®¾è®¡
- âš¡ æ€§èƒ½ä¼˜åŒ–
- ðŸ’¾ æŒä¹…åŒ–æ•°æ®å­˜å‚¨

æ„Ÿè°¢æ‚¨çš„è®¿é—®ï¼`,
      excerpt: 'æ¬¢è¿Žæ¥åˆ°æˆ‘çš„ä¸ªäººåšå®¢ï¼Œè¿™é‡Œåˆ†äº«æˆ‘çš„æŠ€æœ¯å­¦ä¹ å¿ƒå¾—å’Œé¡¹ç›®ç»éªŒã€‚',
      authorId: admin.id,
      views: 0
    },
    {
      title: 'çºªå¿µä¸€ä¸‹ï¼Œæˆ‘ç”¨Claude Codeå®Œæˆäº†ä¸ªäººåšå®¢ç½‘ç«™',
      slug: 'claude-code',
      content: `### **æˆ‘çš„ç¬¬ä¸€ä¸ªä¸ªäººåšå®¢è¯žç”Ÿè®°**

æˆ‘ä¸€ç›´æƒ³æ‹¥æœ‰ä¸€ä¸ªå±žäºŽè‡ªå·±çš„å°è§’è½ï¼Œç”¨æ¥è®°å½•ç”Ÿæ´»ç‚¹æ»´å’Œå¤©é©¬è¡Œç©ºçš„èƒ¡æ€ä¹±æƒ³ã€‚ç»ˆäºŽä¸‹å®šå†³å¿ƒè¦æ­å»ºä¸ªäººåšå®¢ï¼Œä½†é—®é¢˜æ˜¯â€”â€”æˆ‘æ˜¯ä¸ªå½»å¤´å½»å°¾çš„æŠ€æœ¯å°ç™½ã€‚

æœ‹å‹æŽ¨èæˆ‘è¯•è¯• Claude Codeï¼Œè¯´å®ƒèƒ½å¸®å¿™è§£å†³æŠ€æœ¯éš¾é¢˜ã€‚æŠ±ç€è¯•è¯•çœ‹çš„å¿ƒæ€ï¼Œæˆ‘å¼€å§‹äº†è¿™æ®µ"æŠ˜è…¾"ä¹‹æ—…ã€‚

æœ€å¼€å§‹ï¼Œæˆ‘è¿žåŸŸåéƒ½ä¸çŸ¥é“æ€Žä¹ˆé€‰ï¼Œæ›´åˆ«è¯´ä»€ä¹ˆä¸»é¢˜æ¨¡æ¿äº†ã€‚æˆ‘æŠŠè‡ªå·±çš„æƒ³æ³•ä¸€è‚¡è„‘å„¿åœ°å‘Šè¯‰å®ƒï¼š"æˆ‘æƒ³è¦ç®€æ´ä¸€ç‚¹çš„é£Žæ ¼ï¼Œä½†åˆä¸èƒ½å¤ªå•è°ƒï¼Œæœ€å¥½èƒ½æ”¾ç…§ç‰‡â€¦â€¦" å°±è¿™æ ·ä¸ƒå˜´å…«èˆŒåœ°æè¿°ç€ï¼Œç½‘ç«™çš„é›å½¢åœ¨æˆ‘è„‘æµ·ä¸­æ…¢æ…¢å˜å¾—æ¸…æ™°èµ·æ¥ã€‚

å°è±¡æœ€æ·±çš„è¿˜æ˜¯å‰ç«¯éƒ¨ç½²ã€‚æ˜Žæ˜Žçœ‹èµ·æ¥å¾ˆç®€å•çš„åŠŸèƒ½ï¼Œæˆ‘å´æžäº†å¤§åŠå¤©ã€‚æ€»è§‰å¾—æ•ˆæžœä¸å°½å¦‚äººæ„ï¼Œå“åº”å¼è®¾è®¡çš„é—®é¢˜ä¹Ÿéœ€è¦ä¸æ–­ä¼˜åŒ–ã€‚å…ˆè¿™æ ·å§ï¼Œä¸€åˆ‡éƒ½åœ¨æ…¢æ…¢å˜å¥½ã€‚

æœ€æœ‰æˆå°±æ„Ÿçš„æ—¶åˆ»ï¼Œæ˜¯çœ‹åˆ°ç¬¬ä¸€ç¯‡æ–‡ç« å‘å¸ƒæˆåŠŸã€‚çœ‹ç€è¿™ä¸ªäº²æ‰‹æ­å»ºçš„ç½‘ç«™ï¼Œè™½ç„¶è¿˜æœ‰å¾ˆå¤šä¸å®Œç¾Žçš„åœ°æ–¹ï¼Œä½†é‚£ç§æ»¡è¶³æ„ŸçœŸçš„æ— æ³•è¨€å–»ã€‚æœ‹å‹ä»¬çœ‹åˆ°åŽéƒ½å¤¸èµžé¡µé¢è®¾è®¡ä¸é”™ï¼Œæˆ‘å¿ƒé‡Œç¾Žæ»‹æ»‹çš„ã€‚

çŽ°åœ¨åšå®¢åˆšåˆšæˆç«‹ï¼Œæ²¡ä»€ä¹ˆè®¿é—®é‡ï¼Œä½†æ¯æ¬¡æ›´æ–°éƒ½åƒåœ¨ç²¾å¿ƒè£…é¥°è‡ªå·±çš„æˆ¿é—´ã€‚è¿™ä¸ªè¿‡ç¨‹è®©æˆ‘æ˜Žç™½ï¼Œæœ‰æ—¶å€™æœ€å¤§çš„æ”¶èŽ·ï¼Œæˆ–è®¸ä¸æ˜¯é‚£ä¸ªå®Œç¾Žçš„ç»“æžœï¼Œè€Œæ˜¯é‚£ä»½æ•¢äºŽå°è¯•çš„å‹‡æ°”å’ŒåšæŒåˆ°åº•çš„å†³å¿ƒã€‚

## æŠ€æœ¯å‡çº§

çŽ°åœ¨æˆ‘ä»¬å·²ç»å‡çº§åˆ°äº†çœŸæ­£çš„æŒä¹…åŒ–å­˜å‚¨ï¼š

- âœ… **PostgreSQLæ•°æ®åº“**ï¼šä¼ä¸šçº§æ•°æ®å­˜å‚¨
- âœ… **Prisma ORM**ï¼šç±»åž‹å®‰å…¨çš„æ•°æ®åº“æ“ä½œ
- âœ… **è‡ªåŠ¨å¤‡ä»½**ï¼šRailwayåŽŸç”Ÿæ”¯æŒ
- âœ… **æ•°æ®æ°¸ä¹…ä¿å­˜**ï¼šå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæ–‡ç« ä¸¢å¤±ï¼

è¿™ä¸ªåšå®¢çŽ°åœ¨çœŸæ­£æˆä¸ºäº†ä¸€ä¸ªå¯é çš„ä¸ªäººç©ºé—´ã€‚`,
      excerpt: '### **æˆ‘çš„ç¬¬ä¸€ä¸ªä¸ªäººåšå®¢è¯žç”Ÿè®°**\n\næˆ‘ä¸€ç›´æƒ³æ‹¥æœ‰ä¸€ä¸ªå±žäºŽè‡ªå·±çš„å°è§’è½ï¼Œç”¨æ¥è®°å½•ç”Ÿæ´»ç‚¹æ»´å’Œå¤©é©¬è¡Œç©ºçš„èƒ¡æ€ä¹±æƒ³ã€‚ç»ˆäºŽä¸‹å®šå†³å¿ƒè¦æ­å»ºä¸ªäººåšå®¢ï¼Œä½†é—®é¢˜æ˜¯â€”â€”æˆ‘æ˜¯ä¸ªå½»å¤´å½»å°¾çš„æŠ€æœ¯å°ç™½ã€‚\n\næœ‹å‹æŽ¨èæˆ‘è¯•è¯• Claude Codeï¼Œè¯´å®ƒèƒ½å¸®å¿™è§£å†³æŠ€æœ¯éš¾é¢˜ã€‚æŠ±ç€è¯•è¯•çœ‹çš„å¿ƒæ€ï¼Œæˆ‘å¼€å§‹äº†è¿™æ®µ"æŠ˜è…¾"ä¹‹æ—…ã€‚',
      authorId: admin.id,
      views: 0
    }
  ];

  for (const postData of posts) {
    await prisma.post.upsert({
      where: { slug: postData.slug },
      update: {
        title: postData.title,
        content: postData.content,
        excerpt: postData.excerpt
      },
      create: postData
    });
  }

  console.log('çŽ°æœ‰æ–‡ç« å·²è¿ç§»åˆ°PostgreSQL');
  console.log('æ•°æ®è¿ç§»å®Œæˆï¼');
}

main()
  .catch((e) => {
    console.error('æ•°æ®è¿ç§»å¤±è´¥:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });